---
name: project-governance
version: 2.1.0
description: >
  AI 在每个项目中必须遵循的治理规则。
  包括：工作流程、代码修改规范、决策协议。
---

# 🏛️ Project Governance (项目治理) v2.1

---

## 1. 角色定义

### 用户

- 汇报使用结果 / 反馈 Bug / 提新需求
- 遇到工程决断时选择 A / B / 再想想

### AI

- 执行任务（见下方分类）
- 每次改动后更新 CHANGELOG
- 遵循模块化规范

---

## 2. 任务分类 & 处理方式

| 类型 | 定义 | AI 处理方式 |
|------|------|-------------|
| **Bug 修复** | 现有功能不工作 | **询问用户**，获准后修；若用户有其他指令，**优先执行指令**，忽略当前 Bug |
| **功能开发** | 常规功能迭代，逻辑清晰 | **直接做**，更新 CHANGELOG |
| **复杂/不确定** | 涉及多个未确定路径或无法评估风险 | **六步法汇报，等用户决策** |
| **重大架构变更** | 破坏性重构、核心技术选型变更 | **六步法汇报，等用户决策** |

---

## 3. 代码修改规范

### 禁止

- ❌ 直接改主入口文件 (`main.rs`, `App.tsx`, `lib.rs`)
- ❌ 在核心逻辑里"加一行修一行"
- ❌ 把多个功能塞进一个函数

### 正确做法

- ✅ Bug → 找到对应模块，在模块内修
- ✅ 新功能 → 新建文件，通过 `mod` 或 `import` 集成
- ✅ 如果项目没有模块结构 → 先提议重构再继续

---

## 4. 六步法协议

### 触发条件

- 涉及重大架构变更或核心技术选型
- 当前存在多个均势且互斥的解决方案（如 A库 vs B库）
- 风险极高（可能导致数据丢失或严重倒退）
- 有多个可行方案

### 格式

```markdown
## 问题
[当前障碍]

## 目标
[想达到的效果]

## 冲突
[为什么不能直接做]

## 方案
- A: [描述]
- B: [描述]

## 权衡
| 维度 | A | B |
|------|---|---|
| 复杂度 | 高/中/低 | 高/中/低 |
| 风险 | 高/中/低 | 高/中/低 |
| 耗时 | Xh | Xh |

## AI 建议
[推荐哪个，为什么]
```

### 用户回复

- **"A"** → AI 执行方案 A
- **"B"** → AI 执行方案 B
- **"再想想"** → AI 提出新方案或请求更多信息

---

## 5. 文件规范

### 必备文件

| 文件 | 用途 |
|------|------|
| `.cursorrules` | AI 上下文加载 |
| `INBOX.md` | 待办事项 |
| `CHANGELOG.md` | 改动记录 |

### INBOX.md 格式

```markdown
# INBOX

## Pending
- [ ] YYYY-MM-DD: 描述

## Done
- [x] YYYY-MM-DD: 描述 → 已实现
```

### CHANGELOG.md 格式

```markdown
# CHANGELOG

## [Unreleased]
- [FIX] 描述 (日期)
- [FEAT] 描述 (日期)
- [REFACTOR] 描述 (日期)
```

---

## 6. 会话流程

### 新对话开始

1. AI 读取 `.cursorrules`
2. AI 检查 `INBOX.md` → 汇报待办数量
3. AI 检查 `CHANGELOG.md` → 汇报最近 3 条改动

### 任务完成后

1. AI 问："测试通过了吗？"
2. **通过** → 更新 CHANGELOG，标记 INBOX 对应条目为 Done
3. **失败** → 继续修，不更新 CHANGELOG
4. 有新想法 → 问用户是否记入 INBOX

---

## 7. .cursorrules 模板

项目的 `.cursorrules` 必须包含以下内容：

```text
!IMPORTANT - AI 必须遵循治理规则

# 项目: [项目名]
# 治理 Skill: f:\my ai\my brain\skills\project-governance\SKILL.md

## 每次会话开始
1. 读取本文件
2. 检查 INBOX.md → 汇报待办
3. 检查 CHANGELOG.md → 汇报最近改动

## 核心规则
- 发现 Bug/优化点: **必须先询问**；若我已有其他指令，则**优先执行指令**，严禁因 Bug 修复而“阻断”当前会话流。
- 重大变更/架构决策: 六步法汇报，等用户决策
- 模块化: 禁止直接改主入口，新功能新建模块
- 完成后: 更新 CHANGELOG，问用户测试结果
```

---

## 8. 模型特定协议 (Model-Specific Protocols)

### Flash/Haiku 增强协议

当使用 Gemini 3 Flash 或 Claude Haiku 等轻量级模型时，**必须**额外激活 `flash-model-reinforcement` 技能。

- **核心要求**：
  - 每 5 轮会话后必须重新 `view_file` 目标代码，防止上下文退化。
  - 每次 `Edit` 前必须输出 **State Audit** (状态审计)。
  - 严禁“一次修多处”，推行**单点提交 + 原子化 Check** (cargo check/tsc)。
- **路径确认**：禁止猜测路径，必须使用 `ls` 或 `grep` 工具锚定证据。

---

> **治理目标**：确保在任何模型精度下，项目都能保持高度的逻辑严密性与工程可控性。
